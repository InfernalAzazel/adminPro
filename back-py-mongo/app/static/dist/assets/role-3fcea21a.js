import{E as ke,F as De,G as ae,H as Re,T as Me,r as n,I as le,g as ie,J as ce,K as _e,M as Ee,N as Fe,O as Ne,Q as qe,W as Be,l as He,U as Ae,V as we,X as ze,Y as Ye,Z as te,$ as Ke,a0 as se,z as R,j as i,B as Le,D as We,a1 as X,S as Ge}from"./index-bca867e7.js";import{P as Ue,a as Ve,B as Ze,M as oe,b as Xe,T as re}from"./Table-da38efb5.js";import"./index-99662a6d.js";const Qe=e=>{const{paddingXXS:a,lineWidth:c,tagPaddingHorizontal:o,componentCls:l,calc:r}=e,u=r(o).sub(c).equal(),C=r(a).sub(c).equal();return{[l]:Object.assign(Object.assign({},De(e)),{display:"inline-block",height:"auto",marginInlineEnd:e.marginXS,paddingInline:u,fontSize:e.tagFontSize,lineHeight:e.tagLineHeight,whiteSpace:"nowrap",background:e.defaultBg,border:`${ae(e.lineWidth)} ${e.lineType} ${e.colorBorder}`,borderRadius:e.borderRadiusSM,opacity:1,transition:`all ${e.motionDurationMid}`,textAlign:"start",position:"relative",[`&${l}-rtl`]:{direction:"rtl"},"&, a, a:hover":{color:e.defaultColor},[`${l}-close-icon`]:{marginInlineStart:C,fontSize:e.tagIconSize,color:e.colorTextDescription,cursor:"pointer",transition:`all ${e.motionDurationMid}`,"&:hover":{color:e.colorTextHeading}},[`&${l}-has-color`]:{borderColor:"transparent",[`&, a, a:hover, ${e.iconCls}-close, ${e.iconCls}-close:hover`]:{color:e.colorTextLightSolid}},"&-checkable":{backgroundColor:"transparent",borderColor:"transparent",cursor:"pointer",[`&:not(${l}-checkable-checked):hover`]:{color:e.colorPrimary,backgroundColor:e.colorFillSecondary},"&:active, &-checked":{color:e.colorTextLightSolid},"&-checked":{backgroundColor:e.colorPrimary,"&:hover":{backgroundColor:e.colorPrimaryHover}},"&:active":{backgroundColor:e.colorPrimaryActive}},"&-hidden":{display:"none"},[`> ${e.iconCls} + span, > span + ${e.iconCls}`]:{marginInlineStart:u}}),[`${l}-borderless`]:{borderColor:"transparent",background:e.tagBorderlessBg}}},Q=e=>{const{lineWidth:a,fontSizeIcon:c,calc:o}=e,l=e.fontSizeSM;return Re(e,{tagFontSize:l,tagLineHeight:ae(o(e.lineHeightSM).mul(l).equal()),tagIconSize:o(c).sub(o(a).mul(2)).equal(),tagPaddingHorizontal:8,tagBorderlessBg:e.colorFillTertiary})},J=e=>({defaultBg:new Me(e.colorFillQuaternary).onBackground(e.colorBgContainer).toHexString(),defaultColor:e.colorText}),ue=ke("Tag",e=>{const a=Q(e);return Qe(a)},J);var Je=globalThis&&globalThis.__rest||function(e,a){var c={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&a.indexOf(o)<0&&(c[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,o=Object.getOwnPropertySymbols(e);l<o.length;l++)a.indexOf(o[l])<0&&Object.prototype.propertyIsEnumerable.call(e,o[l])&&(c[o[l]]=e[o[l]]);return c};const et=n.forwardRef((e,a)=>{const{prefixCls:c,style:o,className:l,checked:r,onChange:u,onClick:C}=e,g=Je(e,["prefixCls","style","className","checked","onChange","onClick"]),{getPrefixCls:P,tag:f}=n.useContext(le),T=h=>{u==null||u(!r),C==null||C(h)},y=P("tag",c),[b,O]=ue(y),$=ie(y,`${y}-checkable`,{[`${y}-checkable-checked`]:r},f==null?void 0:f.className,l,O);return b(n.createElement("span",Object.assign({},g,{ref:a,style:Object.assign(Object.assign({},o),f==null?void 0:f.style),className:$,onClick:T})))}),tt=et,st=e=>_e(e,(a,c)=>{let{textColor:o,lightBorderColor:l,lightColor:r,darkColor:u}=c;return{[`${e.componentCls}-${a}`]:{color:o,background:r,borderColor:l,"&-inverse":{color:e.colorTextLightSolid,background:u,borderColor:u},[`&${e.componentCls}-borderless`]:{borderColor:"transparent"}}}}),ot=ce(["Tag","preset"],e=>{const a=Q(e);return st(a)},J);function rt(e){return typeof e!="string"?e:e.charAt(0).toUpperCase()+e.slice(1)}const W=(e,a,c)=>{const o=rt(c);return{[`${e.componentCls}-${a}`]:{color:e[`color${c}`],background:e[`color${o}Bg`],borderColor:e[`color${o}Border`],[`&${e.componentCls}-borderless`]:{borderColor:"transparent"}}}},nt=ce(["Tag","status"],e=>{const a=Q(e);return[W(a,"success","Success"),W(a,"processing","Info"),W(a,"error","Error"),W(a,"warning","Warning")]},J);var at=globalThis&&globalThis.__rest||function(e,a){var c={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&a.indexOf(o)<0&&(c[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,o=Object.getOwnPropertySymbols(e);l<o.length;l++)a.indexOf(o[l])<0&&Object.prototype.propertyIsEnumerable.call(e,o[l])&&(c[o[l]]=e[o[l]]);return c};const lt=(e,a)=>{const{prefixCls:c,className:o,rootClassName:l,style:r,children:u,icon:C,color:g,onClose:P,closeIcon:f,closable:T,bordered:y=!0}=e,b=at(e,["prefixCls","className","rootClassName","style","children","icon","color","onClose","closeIcon","closable","bordered"]),{getPrefixCls:O,direction:$,tag:h}=n.useContext(le),[M,F]=n.useState(!0);n.useEffect(()=>{"visible"in b&&F(b.visible)},[b.visible]);const N=Ee(g),q=Fe(g),_=N||q,B=Object.assign(Object.assign({backgroundColor:g&&!_?g:void 0},h==null?void 0:h.style),r),m=O("tag",c),[G,E]=ue(m),U=ie(m,h==null?void 0:h.className,{[`${m}-${g}`]:_,[`${m}-has-color`]:g&&!_,[`${m}-hidden`]:!M,[`${m}-rtl`]:$==="rtl",[`${m}-borderless`]:!y},o,l,E),H=x=>{x.stopPropagation(),P==null||P(x),!x.defaultPrevented&&F(!1)},[,A]=Ne(T,f,x=>x===null?n.createElement(qe,{className:`${m}-close-icon`,onClick:H}):n.createElement("span",{className:`${m}-close-icon`,onClick:H},x),null,!1),S=typeof b.onClick=="function"||u&&u.type==="a",w=C||null,V=w?n.createElement(n.Fragment,null,w,u&&n.createElement("span",null,u)):u,z=n.createElement("span",Object.assign({},b,{ref:a,className:U,style:B}),V,A,N&&n.createElement(ot,{key:"preset",prefixCls:m}),q&&n.createElement(nt,{key:"status",prefixCls:m}));return G(S?n.createElement(Be,{component:"Tag"},z):z)},de=n.forwardRef(lt);de.CheckableTag=tt;const ne=de;function dt(){const{t:e}=He(),a=n.useRef(),c=n.useRef(),[o,l]=n.useState(),[r,u]=n.useState(),[C,g]=n.useState(!1),[P,f]=n.useState(!1),[T,y]=n.useState(!1),[b,O]=n.useState(!1),[$,h]=n.useState({current:1,pageSize:10,total:0}),[M,F]=n.useState([]),[N,q]=n.useState([]),[_,B]=n.useState([]),[m,G]=n.useState([]),[E,U]=n.useState([]),[H,A]=n.useState([]),{data:S,loading:w,runAsync:V}=Ae(),{runAsync:z}=we({manual:!0}),{runAsync:x}=ze({manual:!0}),{runAsync:pe}=Ye({manual:!0}),{data:Y,runAsync:me}=te({manual:!0}),{data:K,runAsync:ge}=te({manual:!0}),{data:L,runAsync:fe}=Ke({manual:!0});n.useEffect(()=>{l(S==null?void 0:S.data),h({...$,total:S==null?void 0:S.total,showSizeChanger:!0,showQuickJumper:!0})},[S]),n.useEffect(()=>{const t=(Y==null?void 0:Y.data)||[],{treeData:s}=se(t),p=t==null?void 0:t.map(d=>d.uid);F(p),q(s)},[Y]),n.useEffect(()=>{var d;const t=(K==null?void 0:K.data)||[],{halfCheckedKeys:s}=se(t),p=t.map(j=>j.uid).filter(j=>!s.includes(j));B(p),(d=a.current)==null||d.reload()},[K]),n.useEffect(()=>{const t=(L==null?void 0:L.data)||[],s=t==null?void 0:t.map(p=>p.uid);U(s),G(t)},[L]),n.useEffect(()=>{var t,s;T?(t=c.current)==null||t.resetFields():(s=c.current)==null||s.setFieldsValue(r)},[C]);const Z=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:e("multipurpose.uid"),dataIndex:"uid",copyable:!0,ellipsis:!0},{title:e("pages.system.role.name"),dataIndex:"name",copyable:!0,ellipsis:!0,formItemProps:{rules:[{required:!0,message:e("multipurpose.rules.required")}]}},{title:e("pages.system.role.describe"),dataIndex:"describe",copyable:!0,ellipsis:!0,formItemProps:{rules:[{required:!0,message:e("multipurpose.rules.required")}]}},{title:e("multipurpose.create_at"),key:"create_at",dataIndex:"create_at",valueType:"dateRange",search:{transform:t=>({startCreateTime:R(t[0],"YYYY-MM-DDTHH:mm:ss.SSS[Z]"),endCreateTime:R(t[1],"YYYY-MM-DDTHH:mm:ss.SSS[Z]")})},render:(t,s)=>R(s.create_at)},{title:e("multipurpose.update_at"),dataIndex:"update_at",valueType:"dateRange",search:{transform:t=>({startUpdateTime:R(t[0],"YYYY-MM-DDTHH:mm:ss.SSS[Z]"),endUpdateTime:R(t[1],"YYYY-MM-DDTHH:mm:ss.SSS[Z]")})},render:(t,s)=>R(s.update_at)},{title:e("multipurpose.operate"),valueType:"option",key:"option",fixed:"right",hideInDescriptions:!0,render:(t,s)=>[i.jsx("a",{onClick:()=>ee(s,!1),children:e("multipurpose.edit")}),i.jsx("a",{className:"text-blueGray",onClick:()=>ye(s),children:e("multipurpose.view")}),i.jsx(Ue,{title:e("multipurpose.prompt"),description:e("multipurpose.isDel"),onConfirm:()=>be(s),okText:e("multipurpose.yes"),cancelText:e("multipurpose.no"),children:i.jsx("a",{className:"text-red",children:e("multipurpose.del")})}),i.jsx("a",{className:"text-emerald",onClick:()=>Te(s),children:e("pages.system.role.operate.permissions")})]}],he=Z.map(t=>{const s=(p,d)=>t.dataIndex===p?{...t,...d}:t;return{...s("uid",{readonly:!0,hideInForm:T}),...s("create_at",{hideInForm:!0}),...s("update_at",{hideInForm:!0})}});function ee(t,s=!0){var p;(p=a.current)==null||p.reload(),s?(y(!0),u(void 0)):(y(!1),u(t)),g(!0)}async function Ce(t){var s;T?await z(t):await x(t.uid,t),g(!1),(s=a.current)==null||s.reload()}function ye(t){u(t),O(!0)}async function be(t){var s;await pe(t.name),(s=a.current)==null||s.reload()}function Se(){O(!1),u(void 0)}function xe(){O(!1),u(void 0)}async function Te(t){var s;await me(),await ge(t.menu_permission,!0),await fe(),A(t.interface_permission),u(t),f(!0),(s=a.current)==null||s.reload()}async function ve(){var t;f(!1),r&&await x(r.uid,r),(t=a.current)==null||t.reload()}function Pe(){f(!1)}function Oe(t,s){var I;const p=Array.isArray(t)?t:t.checked,d=p.concat(s.halfCheckedKeys||[]),j=M==null?void 0:M.filter(D=>!(r!=null&&r.menu_permission.includes(D))&&d.includes(D)),k=(I=r==null?void 0:r.menu_permission)==null?void 0:I.filter(D=>!(d!=null&&d.includes(D))),v={...r||{},menu_permission:[...(r==null?void 0:r.menu_permission.filter(D=>!(k!=null&&k.some($e=>$e===D))))||[],...j||[]]};B(p),u(v)}function je(t){var k;const s=Array.isArray(t)?t:t.checked,p=E==null?void 0:E.filter(v=>{var I;return!((I=r==null?void 0:r.interface_permission)!=null&&I.includes(v))&&s.includes(v)}),d=(k=r==null?void 0:r.interface_permission)==null?void 0:k.filter(v=>!(s!=null&&s.includes(v))),j={...r||{},interface_permission:[...(r==null?void 0:r.interface_permission.filter(v=>!(d!=null&&d.some(I=>I===v))))||[],...p||[]]};A(s),u(j)}function Ie(t){const s=t,d={GET:"blue",POST:"green",PUT:"volcano",DELETE:"red"}[s.method]||"default";return i.jsx(i.Fragment,{children:i.jsxs(Ge,{children:[i.jsxs("span",{children:[" ",s.name," "]}),i.jsx(ne,{color:"default",children:s.group}),i.jsx(ne,{color:d,children:s.method})]})})}return i.jsxs(i.Fragment,{children:[i.jsx(Ve,{columns:Z,actionRef:a,cardBordered:!0,loading:w,request:async t=>(await V(t),Promise.resolve({data:[],success:!0})),dataSource:o,options:{setting:{listsHeight:400}},pagination:$,onChange:t=>h(t),columnsState:{persistenceKey:"roleColumnsState",persistenceType:"localStorage"},rowKey:"uid",toolBarRender:()=>[i.jsx(Le,{icon:i.jsx(We,{}),onClick:()=>ee(),type:"primary",children:e("multipurpose.new")},"button")]}),i.jsx(Ze,{title:e(T?"multipurpose.new":"multipurpose.edit"),formRef:c,open:C,onOpenChange:g,layoutType:"ModalForm",columns:he,onFinish:Ce}),i.jsx(oe,{title:e("multipurpose.view"),open:b,onOk:Se,onCancel:xe,children:i.jsx(Xe,{dataSource:r,bordered:!0,column:1,columns:Z})}),i.jsx(oe,{width:800,title:e("pages.system.role.setPermissions"),open:P,onOk:ve,onCancel:Pe,children:i.jsxs(X,{split:"vertical",children:[i.jsx(X,{title:e("pages.system.role.menuLabel"),headerBordered:!0,children:i.jsx("div",{style:{height:360},children:i.jsx(re,{checkable:!0,fieldNames:{key:"uid",title:"name"},checkedKeys:_,onCheck:Oe,treeData:N,height:360})})}),i.jsx(X,{title:e("pages.system.role.interfaceLabel"),colSpan:"60%",headerBordered:!0,children:i.jsx(re,{checkable:!0,fieldNames:{key:"uid",title:"name"},checkedKeys:H,onCheck:je,treeData:m,height:360,titleRender:Ie})})]})})]})}export{dt as default};
